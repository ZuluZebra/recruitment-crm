<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecruitPro CRM - Chris van der Merwe</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Supabase configuration
        const CONFIG = {
            supabaseUrl: 'https://zrnezxeoyuzynvrouart.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpybmV6eGVveXV6eW52cm91YXJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1NDc1NDEsImV4cCI6MjA2NDEyMzU0MX0.lVA0PHErWqlRcFaXSnjN9glU7oNL0Ir2-XV-jgfffc4'
        };

        // Simple Supabase client
        const supabase = {
            async request(endpoint, options = {}) {
                try {
                    const response = await fetch(`${CONFIG.supabaseUrl}/rest/v1/${endpoint}`, {
                        headers: {
                            'apikey': CONFIG.supabaseKey,
                            'Authorization': `Bearer ${CONFIG.supabaseKey}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation',
                            ...options.headers
                        },
                        ...options
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    return { data, error: null };
                } catch (error) {
                    console.error('Supabase request failed:', error);
                    return { data: null, error };
                }
            },

            async select(table, query = '') {
                return this.request(`${table}?${query}`);
            },

            async insert(table, data) {
                return this.request(table, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            },

            async update(table, data, filter) {
                return this.request(`${table}?${filter}`, {
                    method: 'PATCH',
                    body: JSON.stringify(data)
                });
            }
        };

        const RecruitmentCRM = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [candidates, setCandidates] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [statusFilter, setStatusFilter] = useState('all');
            const [showAddForm, setShowAddForm] = useState(false);
            const [showConfig, setShowConfig] = useState(false);
            const [editingCandidate, setEditingCandidate] = useState(null);
            const [viewingCandidate, setViewingCandidate] = useState(null);
            const [loginPassword, setLoginPassword] = useState('');

            const [users] = useState([
                { id: 1, name: 'Chris van der Merwe', email: 'chris@company.com', role: 'admin', avatar: 'CM', password: 'NextGen' }
            ]);

            const statuses = [
                { value: 'new', label: 'New', color: 'bg-blue-100 text-blue-800' },
                { value: 'screening', label: 'Screening', color: 'bg-yellow-100 text-yellow-800' },
                { value: 'interviewing', label: 'Interviewing', color: 'bg-purple-100 text-purple-800' },
                { value: 'offer', label: 'Offer Extended', color: 'bg-green-100 text-green-800' },
                { value: 'hired', label: 'Hired', color: 'bg-green-100 text-green-800' },
                { value: 'rejected', label: 'Rejected', color: 'bg-red-100 text-red-800' },
                { value: 'do-not-contact', label: 'Do Not Contact', color: 'bg-gray-100 text-gray-800' }
            ];

            // Load candidates from Supabase
            const loadCandidates = async () => {
                try {
                    const { data, error } = await supabase.select('candidates');
                    if (error) {
                        console.error('Failed to load candidates:', error);
                        setCandidates([
                            {
                                id: 1,
                                name: 'Alice Rodriguez (Demo)',
                                email: 'alice.rodriguez@email.com',
                                phone: '+1 (555) 123-4567',
                                position: 'Senior React Developer',
                                job_title: 'Lead Frontend Developer',
                                company: 'Tech Innovations Inc',
                                status: 'interviewing',
                                confidential: false,
                                location: 'San Francisco, CA',
                                added_by: 'Chris van der Merwe',
                                added_date: '2025-05-25',
                                last_updated: '2025-05-28'
                            }
                        ]);
                    } else {
                        setCandidates(data || []);
                    }
                } catch (err) {
                    console.error('Connection error:', err);
                }
            };

            // Save candidate to Supabase
            const saveCandidate = async (candidateData) => {
                try {
                    if (candidateData.id && candidates.find(c => c.id === candidateData.id)) {
                        const { error } = await supabase.update('candidates', candidateData, `id=eq.${candidateData.id}`);
                        if (!error) {
                            setCandidates(prev => prev.map(c => c.id === candidateData.id ? candidateData : c));
                        }
                    } else {
                        const newCandidate = { ...candidateData };
                        delete newCandidate.id;
                        const { data, error } = await supabase.insert('candidates', newCandidate);
                        if (!error && data && data[0]) {
                            setCandidates(prev => [...prev, data[0]]);
                        } else {
                            setCandidates(prev => [...prev, { ...candidateData, id: Date.now() }]);
                        }
                    }
                } catch (err) {
                    console.error('Save error:', err);
                }
            };

            useEffect(() => {
                loadCandidates();
            }, []);

            // Login Screen
            if (!currentUser) {
                return React.createElement('div', { 
                    className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center" 
                }, 
                    React.createElement('div', { 
                        className: "bg-white p-8 rounded-xl shadow-lg w-full max-w-md" 
                    },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('h1', { className: "text-3xl font-bold text-gray-900 mb-2" }, "RecruitPro CRM"),
                            React.createElement('p', { className: "text-gray-600" }, "Secure recruitment management system"),
                            React.createElement('div', { className: "mt-3 p-2 bg-green-100 rounded-lg" },
                                React.createElement('p', { className: "text-sm text-green-800" }, "✅ Connected to Database")
                            )
                        ),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', { className: "text-center" },
                                React.createElement('div', { 
                                    className: "w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold text-xl mx-auto mb-4" 
                                }, "CM"),
                                React.createElement('h3', { className: "text-lg font-semibold text-gray-700" }, "Chris van der Merwe"),
                                React.createElement('p', { className: "text-sm text-gray-500" }, "Administrator")
                            ),
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Password"),
                                    React.createElement('input', {
                                        type: "password",
                                        value: loginPassword,
                                        onChange: (e) => setLoginPassword(e.target.value),
                                        placeholder: "Enter your password",
                                        className: "w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500",
                                        onKeyPress: (e) => {
                                            if (e.key === 'Enter') {
                                                if (loginPassword === users[0].password) {
                                                    setCurrentUser(users[0]);
                                                } else {
                                                    alert('Incorrect password');
                                                    setLoginPassword('');
                                                }
                                            }
                                        }
                                    })
                                ),
                                React.createElement('button', {
                                    onClick: () => {
                                        if (loginPassword === users[0].password) {
                                            setCurrentUser(users[0]);
                                        } else {
                                            alert('Incorrect password');
                                            setLoginPassword('');
                                        }
                                    },
                                    className: "w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 font-medium"
                                }, "Sign In")
                            )
                        )
                    )
                );
            }

            // Simple dashboard for space reasons
            const filteredCandidates = candidates.filter(candidate => {
                if (candidate.confidential && currentUser.role !== 'admin') {
                    return false;
                }
                
                const matchesSearch = candidate.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     candidate.position.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     candidate.email.toLowerCase().includes(searchTerm.toLowerCase());
                
                const matchesStatus = statusFilter === 'all' || candidate.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });

            return React.createElement('div', { className: "min-h-screen bg-gray-50" },
                // Header
                React.createElement('header', { className: "bg-white shadow-sm border-b" },
                    React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" },
                        React.createElement('div', { className: "flex justify-between items-center h-16" },
                            React.createElement('div', { className: "flex items-center" },
                                React.createElement('h1', { className: "text-xl font-bold text-gray-900 mr-4" }, "RecruitPro CRM"),
                                React.createElement('span', { 
                                    className: "px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full" 
                                }, "Database Connected")
                            ),
                            React.createElement('div', { className: "flex items-center space-x-4" },
                                React.createElement('div', { className: "flex items-center space-x-2" },
                                    React.createElement('div', { 
                                        className: "w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center" 
                                    },
                                        React.createElement('span', { 
                                            className: "text-sm font-medium text-indigo-600" 
                                        }, currentUser.avatar)
                                    ),
                                    React.createElement('span', { 
                                        className: "text-sm font-medium text-gray-700" 
                                    }, currentUser.name),
                                    React.createElement('button', {
                                        onClick: () => {
                                            setCurrentUser(null);
                                            setLoginPassword('');
                                        },
                                        className: "ml-4 text-sm text-gray-500 hover:text-gray-700"
                                    }, "Sign Out")
                                )
                            )
                        )
                    )
                ),

                // Main Content
                React.createElement('main', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" },
                    React.createElement('div', { className: "space-y-6" },
                        // Stats
                        React.createElement('div', { className: "grid grid-cols-3 gap-6" },
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border" },
                                React.createElement('p', { className: "text-sm font-medium text-gray-600" }, "Total Candidates"),
                                React.createElement('p', { className: "text-2xl font-bold text-gray-900" }, candidates.length)
                            ),
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border" },
                                React.createElement('p', { className: "text-sm font-medium text-gray-600" }, "Interviewing"),
                                React.createElement('p', { className: "text-2xl font-bold text-gray-900" }, 
                                    candidates.filter(c => c.status === 'interviewing').length)
                            ),
                            React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border" },
                                React.createElement('p', { className: "text-sm font-medium text-gray-600" }, "Hired"),
                                React.createElement('p', { className: "text-2xl font-bold text-gray-900" }, 
                                    candidates.filter(c => c.status === 'hired').length)
                            )
                        ),

                        // Search and Add
                        React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-sm border" },
                            React.createElement('div', { className: "flex space-x-4" },
                                React.createElement('input', {
                                    type: "text",
                                    placeholder: "Search candidates...",
                                    value: searchTerm,
                                    onChange: (e) => setSearchTerm(e.target.value),
                                    className: "flex-1 p-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                                }),
                                React.createElement('select', {
                                    value: statusFilter,
                                    onChange: (e) => setStatusFilter(e.target.value),
                                    className: "px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                                },
                                    React.createElement('option', { value: "all" }, "All Statuses"),
                                    ...statuses.map(status => 
                                        React.createElement('option', { key: status.value, value: status.value }, status.label)
                                    )
                                ),
                                React.createElement('button', {
                                    onClick: () => {
                                        const name = prompt("Candidate Name:");
                                        const email = prompt("Email:");
                                        const position = prompt("Position:");
                                        const jobTitle = prompt("Job Title:");
                                        const company = prompt("Company:");
                                        
                                        if (name && email && position && jobTitle) {
                                            const newCandidate = {
                                                id: Date.now(),
                                                name, email, position, job_title: jobTitle, company: company || '',
                                                phone: '', location: '', status: 'new', confidential: false,
                                                added_by: currentUser.name,
                                                added_date: new Date().toISOString().split('T')[0],
                                                last_updated: new Date().toISOString().split('T')[0]
                                            };
                                            saveCandidate(newCandidate);
                                        }
                                    },
                                    className: "bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700"
                                }, "➕ Add Candidate")
                            )
                        ),

                        // Candidates Table
                        React.createElement('div', { className: "bg-white rounded-xl shadow-sm border overflow-hidden" },
                            React.createElement('div', { className: "overflow-x-auto" },
                                React.createElement('table', { className: "w-full" },
                                    React.createElement('thead', { className: "bg-gray-50" },
                                        React.createElement('tr', null,
                                            React.createElement('th', { 
                                                className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" 
                                            }, "Candidate"),
                                            React.createElement('th', { 
                                                className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" 
                                            }, "Position"),
                                            React.createElement('th', { 
                                                className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" 
                                            }, "Status"),
                                            React.createElement('th', { 
                                                className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" 
                                            }, "Company"),
                                            React.createElement('th', { 
                                                className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" 
                                            }, "Actions")
                                        )
                                    ),
                                    React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                        filteredCandidates.map(candidate => {
                                            const status = statuses.find(s => s.value === candidate.status);
                                            return React.createElement('tr', { key: candidate.id, className: "hover:bg-gray-50" },
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                                                    React.createElement('div', { className: "flex items-center" },
                                                        React.createElement('div', { 
                                                            className: "h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center mr-4" 
                                                        },
                                                            React.createElement('span', { 
                                                                className: "text-sm font-medium text-indigo-600" 
                                                            }, candidate.name.split(' ').map(n => n[0]).join(''))
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('div', { className: "text-sm font-medium text-gray-900" }, candidate.name),
                                                            React.createElement('div', { className: "text-sm text-gray-500" }, candidate.email)
                                                        )
                                                    )
                                                ),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                                                    React.createElement('div', { className: "text-sm text-gray-900" }, candidate.position),
                                                    React.createElement('div', { className: "text-sm text-gray-500" }, candidate.job_title)
                                                ),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap" },
                                                    React.createElement('span', { 
                                                        className: `px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${status?.color}` 
                                                    }, status?.label)
                                                ),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-900" }, 
                                                    candidate.company),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium" },
                                                    React.createElement('button', {
                                                        onClick: () => {
                                                            const newStatus = candidate.status === 'new' ? 'screening' : 
                                                                           candidate.status === 'screening' ? 'interviewing' :
                                                                           candidate.status === 'interviewing' ? 'offer' : 'new';
                                                            const updatedCandidate = {
                                                                ...candidate,
                                                                status: newStatus,
                                                                last_updated: new Date().toISOString().split('T')[0]
                                                            };
                                                            saveCandidate(updatedCandidate);
                                                        },
                                                        className: "text-indigo-600 hover:text-indigo-900 mr-4"
                                                    }, "📈 Next Stage"),
                                                    React.createElement('button', {
                                                        onClick: () => {
                                                            const notes = prompt(`Notes for ${candidate.name}:`, candidate.notes || '');
                                                            if (notes !== null) {
                                                                saveCandidate({...candidate, notes, last_updated: new Date().toISOString().split('T')[0]});
                                                            }
                                                        },
                                                        className: "text-green-600 hover:text-green-900"
                                                    }, "📝 Notes")
                                                )
                                            );
                                        })
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(RecruitmentCRM), document.getElementById('root'));
    </script>
</body>
</html>
